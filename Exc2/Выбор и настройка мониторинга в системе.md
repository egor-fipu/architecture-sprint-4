### **Мониторинг для системы компании «Александрит»**

---

#### **1. Мотивация**

Добавление полноценного мониторинга позволит компании:  
1. **Обеспечить стабильность системы:**  
   - Выявлять узкие места и предотвращать сбои на ранних этапах.  
   - Гарантировать бесперебойную работу сайта, API и баз данных.  

2. **Увеличить прозрачность процессов:**  
   - Отслеживать работу систем в реальном времени, включая взаимодействие с клиентами и внутренними сервисами.  
   - Анализировать причины проблем, повышая доверие со стороны клиентов.  

3. **Оптимизировать ресурсы:**  
   - Предотвращать ситуации с переполнением очередей RabbitMQ или нехваткой ресурсов серверов.  
   - Эффективно планировать масштабирование инфраструктуры.  

4. **Улучшить пользовательский опыт:**  
   - Сократить время отклика систем и уменьшить процент ошибок.  
   - Обеспечить высокий уровень надежности API для B2B и B2C пользователей.  

Без мониторинга сложно будет точно определить причины ошибок, оптимизировать производительность или принимать обоснованные решения о масштабировании.  

---

#### **2. Выбор подхода к мониторингу**  

Разные части системы требуют применения разных подходов:  
- **Для API (интернет-магазин, CRM, MES):**  
  Используем подход **RED** (Rate, Errors, Duration) для контроля запросов, ошибок и задержек.  

- **Для серверов и баз данных:**  
  Применяем подход **USE** (Utilization, Saturation, Errors) для оценки состояния ресурсов и предотвращения перегрузок.  

- **Для анализа пользовательского опыта:**  
  Используем подход **Четыре золотых сигнала** (Latency, Traffic, Errors, Saturation), чтобы оценивать производительность и нагрузку.  

---
#### **3. Метрики для мониторинга**  

**A. RabbitMQ**  
1. **Number of dead-letter-exchange letters**  
   - Зачем нужна: для контроля отказов при обработке сообщений.  
   - Ярлыки: очередь, тип сообщения.  
2. **Number of messages in flight**  
   - Зачем нужна: для оценки нагрузки на потребителей сообщений.  
   - Ярлыки: очередь, тип сообщения.  

**B. API (интернет-магазин, CRM, MES)**  
1. **Number of requests (RPS)**  
   - Зачем нужна: для отслеживания объема нагрузки и предотвращения перегрузок.  
   - Ярлыки: метод, путь.  
2. **Response time (latency)**  
   - Зачем нужна: для анализа производительности API.  
   - Ярлыки: метод, путь.  
3. **Number of HTTP 500 errors**  
   - Зачем нужна: для контроля стабильности API.  
   - Ярлыки: метод, статус.  
4. **Number of simultanious sessions**  
   - Зачем нужна: для мониторинга пиковой нагрузки и планирования масштабирования.  
   - Ярлыки: тип API.  

**C. Серверы и базы данных**  
1. **CPU Utilisation**  
   - Зачем нужна: для предотвращения перегрузки серверов.  
   - Ярлыки: имя инстанса.  
2. **Memory Utilisation**  
   - Зачем нужна: для контроля доступных ресурсов памяти.  
   - Ярлыки: имя инстанса.  
3. **Disk I/O**  
   - Зачем нужна: для анализа производительности баз данных и работы RabbitMQ.  
   - Ярлыки: имя инстанса.  
4. **Number of connections**  
   - Зачем нужна: для мониторинга подключения к базам данных.  
   - Ярлыки: имя базы.  
5. **Size of db instance**  
   - Зачем нужна: для контроля использования хранилищ данных.  
   - Ярлыки: имя базы.  

**D. Пользовательский опыт**  
1. **Latency for shop API**  
   - Зачем нужна: для анализа времени ответа API интернет-магазина и улучшения пользовательского опыта.  
   - Ярлыки: роль пользователя.  
2. **Traffic (Kb transferred/received)**  
   - Зачем нужна: для контроля объема передаваемых данных, влияющих на производительность.  
   - Ярлыки: тип API.  

#### **4. План действий**  

1. **Установка инструментов мониторинга:**  
   - Развернуть Prometheus для сбора метрик.  
   - Настроить Grafana для визуализации данных.  

2. **Настройка источников данных:**  
   - Подключить метрики API, RabbitMQ и серверов к Prometheus.  
   - Собирать логи ошибок через ELK (Elastic Stack).  

3. **Настройка оповещений:**  
   - Внедрить Alertmanager для уведомлений о критических событиях (например, превышение порогов нагрузки).  
   - Интегрировать оповещения в Slack или Email.  

4. **Создание дашбордов:**  
   - Разработать панели для мониторинга API, серверов и бизнес-процессов.  
   - Обеспечить доступность данных для бизнеса (метрики времени обработки заказов, процент ошибок).  

5. **Обучение команды:**  
   - Провести обучение для команды о работе с мониторингом.  

---

#### **5. Показатели насыщенности**  

- **RabbitMQ:**  
  - Длина очереди > 1000 сообщений. Действия: уведомление в Slack, автоматическое масштабирование потребителей.  

- **Сервера:**  
  - CPU Utilisation > 85%. Действия: завести тикет на добавление ресурсов или анализ.  

- **API:**  
  - Latency > 500 мс. Действия: уведомление разработчикам, автоматическая проверка причин задержек.  

- **Базы данных:**  
  - Число соединений > 90% от максимального. Действия: уведомление в мониторинг и анализ запросов.  

---

Этот план обеспечит полную прозрачность работы системы и позволит реагировать на проблемы ещё до того, как они скажутся на бизнесе.